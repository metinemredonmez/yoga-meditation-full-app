# Core configuration
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/yoga_db
NODE_ENV=development
PORT=3000

# API Base URL (for Swagger docs in production)
# Example: https://api.yourdomain.com
API_BASE_URL=

# Auth
JWT_ACCESS_SECRET=replace-with-32-char-secret
JWT_REFRESH_SECRET=replace-with-32-char-refresh-secret
JWT_ACCESS_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=30d

# Refresh Token Security
# Enable token rotation (new refresh token on each use)
REFRESH_TOKEN_ROTATION_ENABLED=true
# Detect and block token reuse attacks
REFRESH_TOKEN_REUSE_DETECTION=true
# Maximum concurrent sessions per user
REFRESH_TOKEN_MAX_SESSIONS=5

# SMTP / Email
# For SendGrid: SMTP_HOST=smtp.sendgrid.net, SMTP_USER=apikey, SMTP_PASSWORD=your_api_key
# For Gmail: SMTP_HOST=smtp.gmail.com, SMTP_PORT=587 (use app password)
# For Mailgun: SMTP_HOST=smtp.mailgun.org
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USER=apikey
SMTP_PASSWORD=your_sendgrid_api_key
SMTP_FROM=Yoga App <noreply@yourdomain.com>

# Push notifications (Firebase Cloud Messaging)
# Get these from Firebase Console > Project Settings > Service Accounts > Generate New Private Key
FIREBASE_PROJECT_ID=your-firebase-project-id
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxxxx@your-project.iam.gserviceaccount.com
# Note: Replace newlines with \n in the private key
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"

# Legacy push config (deprecated)
PUSH_PROVIDER_API_KEY=
PUSH_PROVIDER_APP_ID=

# Twilio SMS Configuration
# Get credentials from: https://console.twilio.com/
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# Use either a phone number or messaging service SID
TWILIO_PHONE_NUMBER=+15551234567
# Optional: Messaging Service SID (preferred for scalability)
TWILIO_MESSAGING_SERVICE_SID=
# Enable/disable SMS functionality
SMS_ENABLED=true
# OTP Configuration
OTP_EXPIRY_MINUTES=5
OTP_MAX_ATTEMPTS=3

# Legacy SMS config (deprecated - use TWILIO_* above)
SMS_TWILIO_SID=
SMS_TWILIO_TOKEN=
SMS_TWILIO_FROM=

# Stripe / Iyzico subscriptions
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
IYZICO_API_KEY=
IYZICO_SECRET_KEY=

# AWS S3 Storage
# Required for media upload functionality
S3_BUCKET_NAME=yoga-app-media
S3_REGION=eu-central-1
S3_ACCESS_KEY_ID=your_aws_access_key_id
S3_SECRET_ACCESS_KEY=your_aws_secret_access_key
# Optional: CloudFront CDN URL for faster delivery
STORAGE_CDN_BASE_URL=https://your-distribution.cloudfront.net
# Presigned URL expiration time in seconds (default: 600 = 10 minutes)
STORAGE_SIGNED_URL_TTL_SECONDS=600

# Notification Preferences
# Default timezone for quiet hours
DEFAULT_TIMEZONE=Europe/Istanbul
# Secret key for unsubscribe token generation (REQUIRED - min 32 chars)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
UNSUBSCRIBE_TOKEN_SECRET=replace-with-secure-random-string-min-32-chars

# Encryption key for sensitive data (REQUIRED - min 32 chars)
# IMPORTANT: Use a DIFFERENT key than JWT secrets
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ENCRYPTION_KEY=replace-with-secure-random-string-min-32-chars
# Frontend URL for unsubscribe links
FRONTEND_URL=http://localhost:3000

# Redis Configuration
# Required for distributed rate limiting (optional - falls back to in-memory)
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=

# Rate Limiting
# Enable/disable rate limiting globally
RATE_LIMIT_ENABLED=true
# Trust X-Forwarded-For header for client IP detection
RATE_LIMIT_TRUST_PROXY=true
# Skip rate limiting for successful requests (not recommended)
RATE_LIMIT_SKIP_SUCCESSFUL_REQUESTS=false

# API Keys
# Prefix for production API keys
API_KEY_PREFIX_LIVE=yk_live_
# Prefix for test/development API keys
API_KEY_PREFIX_TEST=yk_test_

# Cache Configuration
# Enable/disable caching globally
CACHE_ENABLED=true
# Default cache TTL in seconds (5 minutes)
CACHE_DEFAULT_TTL=300
# TTL for programs cache (10 minutes)
CACHE_PROGRAMS_TTL=600
# TTL for poses cache (1 hour)
CACHE_POSES_TTL=3600
# TTL for tags cache (24 hours)
CACHE_TAGS_TTL=86400
# TTL for user data cache (5 minutes)
CACHE_USER_TTL=300
# TTL for stats cache (1 minute)
CACHE_STATS_TTL=60
# Warm cache on server startup
CACHE_WARM_ON_START=false
# Enable debug logging for cache operations
CACHE_DEBUG=false

# Webhook Configuration
# Enable/disable webhook system globally
WEBHOOK_ENABLED=true
# Timeout for webhook delivery requests (milliseconds)
WEBHOOK_TIMEOUT_MS=30000
# Maximum retry attempts for failed deliveries
WEBHOOK_MAX_RETRIES=5
# Retry delays in seconds (comma-separated: 1m, 5m, 15m, 1h, 24h)
WEBHOOK_RETRY_DELAYS=60,300,900,3600,86400
# Length of generated webhook secrets
WEBHOOK_SECRET_LENGTH=32
# HTTP header name for webhook signatures
WEBHOOK_SIGNATURE_HEADER=X-Webhook-Signature
# Queue processing interval (milliseconds)
WEBHOOK_QUEUE_INTERVAL_MS=5000
# Retry processing interval (milliseconds)
WEBHOOK_RETRY_INTERVAL_MS=60000

# ============================================
# Agora - Live Streaming
# ============================================
# Get credentials from: https://console.agora.io/
AGORA_APP_ID=your_agora_app_id
AGORA_APP_CERTIFICATE=your_agora_app_certificate
# REST API credentials (for cloud recording, channel management)
AGORA_CUSTOMER_ID=your_customer_id
AGORA_CUSTOMER_SECRET=your_customer_secret
# Cloud Recording S3 Storage (can use MinIO in development)
AGORA_RECORDING_BUCKET=yoga-recordings
AGORA_RECORDING_ACCESS_KEY=your_s3_access_key
AGORA_RECORDING_SECRET_KEY=your_s3_secret_key
AGORA_RECORDING_REGION=eu

# Live Stream Settings
LIVE_STREAM_MAX_PARTICIPANTS=100
LIVE_STREAM_RECORDING_ENABLED=true
LIVE_STREAM_CHAT_RATE_LIMIT=10

# ============================================
# Kafka - Event Streaming (Optional)
# ============================================
KAFKA_ENABLED=false
KAFKA_BROKERS=localhost:29092
KAFKA_CLIENT_ID=yoga-app
KAFKA_GROUP_ID=yoga-app-group

# ============================================
# RabbitMQ - Message Queue (Email, SMS, Tasks)
# ============================================
RABBITMQ_ENABLED=false
RABBITMQ_URL=amqp://yoga_user:yoga_rabbit_pass@localhost:5672/yoga

# ============================================
# Elasticsearch - Search & Analytics (Optional)
# ============================================
ELASTICSEARCH_ENABLED=false
ELASTICSEARCH_URL=http://localhost:9200
ELASTICSEARCH_INDEX_PREFIX=yoga

# ============================================
# Sentry - Error Tracking & Performance
# ============================================
SENTRY_ENABLED=false
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_RELEASE=yoga-app@1.0.0

# ============================================
# Prometheus Metrics
# ============================================
METRICS_ENABLED=true
METRICS_PATH=/metrics

# ============================================
# OneSignal - Push Notifications (Alternative to Firebase)
# ============================================
ONESIGNAL_APP_ID=your_onesignal_app_id
ONESIGNAL_REST_API_KEY=your_onesignal_rest_api_key
# Provider selection: firebase, onesignal, auto (tries both)
PUSH_PROVIDER=auto

# ============================================
# NetGSM - SMS Provider (Turkey)
# ============================================
NETGSM_USER_CODE=your_netgsm_user
NETGSM_PASSWORD=your_netgsm_password
NETGSM_HEADER=YOGAAPP
# Provider selection: twilio, netgsm, auto
SMS_PROVIDER=auto

# ============================================
# Apple In-App Purchase
# ============================================
APPLE_SHARED_SECRET=your_apple_shared_secret
APPLE_BUNDLE_ID=com.yourcompany.yogaapp
APPLE_ISSUER_ID=your_apple_issuer_id
APPLE_KEY_ID=your_apple_key_id
# Base64 encoded private key
APPLE_PRIVATE_KEY=your_base64_encoded_private_key
APPLE_ENVIRONMENT=sandbox

# ============================================
# Google Play Billing
# ============================================
GOOGLE_PACKAGE_NAME=com.yourcompany.yogaapp
GOOGLE_SERVICE_ACCOUNT_EMAIL=your-service-account@project.iam.gserviceaccount.com
# Base64 encoded private key
GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY=your_base64_encoded_private_key
# Google Pub/Sub JWT verification audience (your webhook endpoint URL)
# This is used to verify JWT tokens from Google Cloud Pub/Sub push subscriptions
GOOGLE_PUBSUB_AUDIENCE=https://api.yourdomain.com/webhooks/google

# ============================================
# Google OAuth (Social Login)
# ============================================
# Get credentials from: https://console.cloud.google.com/apis/credentials
GOOGLE_CLIENT_ID=your_google_client_id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your_google_client_secret

# ============================================
# Payment Settings
# ============================================
PAYMENT_SUCCESS_URL=http://localhost:3000/payment/success
PAYMENT_CANCEL_URL=http://localhost:3000/payment/cancel
PAYMENT_CURRENCY=TRY
SUBSCRIPTION_GRACE_PERIOD_DAYS=3
OFFLINE_DOWNLOAD_EXPIRY_DAYS=30
MAX_OFFLINE_DOWNLOADS=10

# Misc
CORS_ORIGINS=http://localhost:3000,http://localhost:3001
LOG_LEVEL=info
